<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Filme</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Detalhes do Filme</h1>
    <div id="film-details"></div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            // Obter o parâmetro "id" da URL
            const urlParams = new URLSearchParams(window.location.search);
            const movieId = urlParams.get("id");

            if (!movieId) {
                alert("Nenhum ID de filme fornecido!");
                return;
            }

            try {
                // Faça a requisição para pegar os detalhes do filme com o 'id' correto
                const response = await fetch(`http://localhost:5500/get_film/${movieId}`);
                const movieData = await response.json();

                if (response.ok && movieData.movies && movieData.movies.length > 0) {
                    const movie = movieData.movies[0];  // Como a API retorna um array, pegamos o primeiro filme.

                    const filmDetails = document.getElementById("film-details");

                    // URL da imagem do poster
                    const posterImage = movie.image !== "Imagem não encontrada" && movie.image !== "N/A" 
                        ? movie.image 
                        : "https://via.placeholder.com/200";

                    // URL do trailer (se houver)
                    const trailerHTML = movie.trailer && movie.trailer.includes("youtube.com")
                        ? `<iframe src="https://www.youtube.com/embed/${movie.trailer.split("v=")[1]}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`
                        : "<p>Trailer não disponível.</p>";

                    // URL do background
                    const background = movie.background && movie.background !== "Background não encontrado"
                        ? `url("${movie.background}")`
                        : "url('https://via.placeholder.com/1280x720?text=Background+não+disponível')";

                    // Adicionar o estilo de background
                    document.body.style.backgroundImage = background;
                    document.body.style.backgroundSize = "cover"; // Opcional, para cobrir toda a tela
                    document.body.style.backgroundPosition = "center"; // Opcional, para centralizar a imagem

                    // Exibir os detalhes do filme
                    filmDetails.innerHTML = `
                        <img src="${posterImage}" alt="${movie.title}" />
                        <h3>${movie.title}</h3>
                        <p><strong>Sinopse:</strong> ${movie.plot || "Sinopse não disponível."}</p>
                        <p><strong>Data de lançamento:</strong> ${movie.release_date || "Data não disponível."}</p>
                        <div><strong>Trailer:</strong>${trailerHTML}</div>
                    `;
                } else {
                    alert("Filme não encontrado.");
                }
            } catch (error) {
                console.error("Erro no frontend:", error);
                alert("Erro ao buscar os detalhes do filme. Tente novamente mais tarde.");
            }
        });
    </script>
</body>
</html>
